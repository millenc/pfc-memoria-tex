% !TeX spellcheck = es_ES
\chapter{Lógica difusa}
\label{cha:logica-difusa}
En esta sección se introducen las bases de la lógica difusa y los mecanismos de inferencia difusa. Además se describen algunos de los métodos clásicos de inferencia difusa basada en reglas.

\section{¿Qué es la lógica difusa?}
La lógica difusa fue introducida por Lofti A. Zadeh en 1965. Desde entonces se ha aplicado en multitud de escenarios tales como control de procesos industriales, medicina, electrónica y otros tipos de sistemas expertos. En general, la mayoría de aplicaciones de la lógica difusa son el área del control.

La motivación para el desarrollo de una lógica difusa fue expresada por Zadeh (1984, BUSCAR CITA) de la siguiente manera:
\begin{quote}
\emph{``La habilidad de la mente humana para razonar en términos difusos es realmente una gran ventaja. Aunque una gran cantidad de información es captada por los sentidos en una situación determinada, de alguna manera la mente humana es capaz de descartar la mayoría de esa información y concentrarse sólo en aquello que es relevante.''}
\end{quote}
El objetivo principal de la lógica difusa es intentar dotar a las máquinas de un sistema de razonamiento aproximado similar al de los humanos, que pueda lidiar con imprecisiones y términos inexactos. Para ello, la lógica difusa se basa en la utilización de variables lingüísticas expresadas en lenguaje natural, que forman la base del razonamiento aproximado. 

Por medio del uso de variables lingüísticas se pueden modelar conceptos como \emph{``muy alto''} o \emph{``bastante caliente''} y establecer relaciones entre ellos, expresadas de forma matemática y algorítmica. Los sistemas de lógica difusa tratan la imprecisión de las entradas mediante el uso de variables lingüísticas (expresadas como conjuntos difusos), que transforman dichos valores de entrada en números difusos.

\section{Reglas difusas}
Una manera de modelar el conocimiento humano es por medio de \emph{reglas difusas IF-THEN}\footnote{Podría traducirse como SI-ENTONCES.}:

\begin{definition}
Una regla difusa IF-THEN es una estructura condicional de la forma:
\begin{equation}
\text{IF [antecedentes] THEN [consecuentes]}
\end{equation},
donde [antecedentes] y [consecuentes] son proposiciones difusas.
\end{definition}

Las proposiciones difusas pueden ser \emph{simples} o \emph{compuestas}. Una proposición difusa simple es un predicado único formado por una variable lingüística \emph{x} y un valor \emph{A} de dicha variable (un conjunto difuso). Es decir, \emph{A} es un conjunto difuso (valor lingüístico) definido sobre el mismo universo de referencia \emph{U} de \emph{x}. Por ejemplo si la variable \emph{x} es la \emph{``Temperatura medida en ºC''} del ejemplo \ref{ex:lang-variable}, entonces las siguientes son proposiciones difusas sobre \emph{x}:

\begin{equation}
\text{$x$ es B}
\end{equation}
\begin{equation}
\text{$x$ es M}
\end{equation}
\begin{equation}
\text{$x$ es A}
\end{equation}

donde \emph{B}, \emph{M} y \emph{A} son los valores lingüísticos ``baja'', ``media'' y ``alta'' respectivamente. Estos valores lingüísticos vienen definidos por conjuntos difusos con funciones de pertenencia $\mu_{Baja}$, $\mu_{Media}$ y $\mu_{Alta}$.

Las proposiciones difusas simples se pueden combinar para formar predicados más complejos. Para ello se utilizan normalmente los conectivos \emph{AND} (intersección difusa) y \emph{OR} (unión difusa). Por ejemplo, se puede definir la condición \emph{``Temperatura es Alta Ó Temperatura es Media''} con la siguiente proposición difusa:

\begin{equation}
\text{$x$ es $A$ OR $x$ es $M$}
\end{equation}

donde $A$ y $M$ son los valores lingüísticos \emph{``alta''} ($\mu_{Alta}$) y \emph{``media''} ($\mu_{Media}$) respectivamente. En la misma proposición difusa se pueden utilizar variables diferentes (generalmente es así) definidas normalmente sobre universos de referencia diferentes. El consecuente generalmente suele ser una proposición difusa simple formado por una variable \emph{y} sobre \emph{V}. Por ello, se puede definir el concepto de \emph{regla difusa IF-THEN} de manera más formal como:

\begin{definition}
Una \emph{regla difusa IF-THEN} es una estructura condicional de la forma:

\begin{equation}
\text{IF $x_{1}$ es $A_{1}$ $\odot$ $x_{2}$ es $A_{2}$ $\odot$ \ldots $\odot$ $x_{n}$ es $A_{n}$ THEN $y$ es $B$}
\end{equation}
donde $x_{1} \in U_{i}$,\ldots, $x_{n} \in U_{n}$,$y \in V$ son variables lingüísticas y $\odot$ algún conectivo difuso (AND,OR,AND NOT,etc.).
\end{definition}

\section{Sistemas difusos basados en reglas}\label{sec:sistemas-difusos-basados-en-reglas}
Un enfoque muy utilizado a la hora de modelar un sistema de lógica difusa es la utilización de \emph{reglas} expresadas en un lenguaje muy próximo al natural, mediante variables lingüísticas. Estas reglas habitualmente son formuladas por un experto humano aunque pueden ser derivadas también de datos numéricos. A este tipo de sistemas difusos se les denomina \emph{sistemas difusos basados en reglas}. Los métodos estudiados en este trabajo pertenecen a este tipo de sistemas.

Existen principalmente 3 tipos de sistemas difusos \cite{wang1997}: sistemas difusos puros, sistemas difusos tipo Takagi-Sugeno-Kang (TKG) y sistemas difusos con difusificador y desdifusificador. A continuación se realiza una breve descripción de las características de estos sistemas.

En la figura \ref{fig:pure-fuzzy-system} se representa el esquema básico de un sistema difuso puro. En los sistemas difusos puros tanto las entradas como la salida del sistema son conjuntos difusos. El sistema difuso está dotado de un \emph{conjunto de reglas difusas} \emph{IF-THEN}, que forman la base de conocimiento sobre el dominio del problema. El \emph{sistema de inferencia difusa} combina estas reglas \emph{IF-THEN} y transforma los conjuntos difusos de entrada sobre el universo $U \subset R^{n}$ ($x_{1}.\ldots,x_{n}$) en un conjunto difuso sobre $V \subset R$ ($y$), utilizando principios de lógica difusa (modus ponens).

\begin{figure}[tb]
	\centering
	\input{figures/pure-fuzzy-system.tikz}
	\caption{Diagrama de un sistema difuso puro.}
	\label{fig:pure-fuzzy-system}
\end{figure}

El principal problema de los sistemas difusos puros es que tanto las entradas como las salidas son conjuntos difusos, mientras que en aplicaciones de control industrial se utilizan generalmente valores escalares reales. Para solucionar este problema, Takagi, Sugeno y Kang propusieron un nuevo método simplificado que utiliza entradas y salidas escalares \cite{takagisugeno1985}\cite{sugenokang1988}.

El método de Takagi-Sugeno-Kang utiliza reglas de la forma:

\begin{equation}
R_{i}: \text{IF }x_{1}\text{ es }A_{1i}\text{, }x_{2}\text{ es }A_{2i}\text{ , \ldots , }x_{n}\text{ es }A_{ni}\text{ THEN } y = f_{i}(x_{1},x_{2},\ldots,x_{n})
\end{equation}

donde $A_{ij}$ representa las funciones de pertenencia asociadas a las variables lingüísticas utilizadas en los antecedentes y $f_{i}(x_{1},x_{2},\ldots,x_{n})$ representa los consecuentes. Normalmente $f_{i}$ es un polinomio en las variables de entrada, pero puede ser cualquier tipo de función mientras pueda describir la salida del modelo de forma apropiada, teniendo en cuenta las entradas. 

Como se puede ver, la principal diferencia entre un sistema difuso puro y el sistema de Takagi-Sugeno-Kang es que el consecuente de la regla (\emph{THEN}) es sustituido por una simple fórmula matemática. Este cambio supone que el método para combinar las diferentes reglas para proporcionar una salida es más sencillo. De hecho, en el método de Takagi-Sugeno-Kang se utiliza la media ponderada de los consecuentes obtenidos de las diferentes reglas.

El principal problema del método de Takagi-Sugeno-Kang es que el consecuente de las reglas es una función matemática y por lo tanto se pierde cierta capacidad de modelar el sistema utilizando el lenguaje natural. Para solucionar estos problemas, se puede modificar el sistema difuso puro, añadiendo un difusificador a la entrada de las variables y un desdifusificador a la salida.

\begin{figure}[tb]
	\centering
	\input{figures/fuzzy-system.tikz}
	\caption{Diagrama de un sistema difuso con difusificador y desdifusificador.}
	\label{fig:fuzzy-system}
\end{figure}

En la figura \ref{fig:fuzzy-system} se representa el esquema básico de un sistema difuso con difusificador y desdifusificador. El difusificador transforma las entradas escalares en $U$ del sistema en conjuntos difusos. Una vez realizada la inferencia difusa se obtiene un conjunto difuso como salida. El desdifusificador transforma el conjunto difuso de salida en una variable escalar en $V$. Existen multitud de métodos para realizar estas transformaciones y en siguientes secciones se detallarán algunos de ellos. El sistema difuso presentado en este trabajo se basa en este último tipo de sistema.

\subsection{Difusificadores}

En la sección \ref{sec:sistemas-difusos-basados-en-reglas} se ha definido un tipo de sistema difuso que utiliza un concepto llamado \emph{difusificador} para transformar las entradas escalares del sistema en conjuntos difusos. Un \emph{difusificador} puede definirse formalmente como:

\begin{definition}\label{def:difusificador}
Un \emph{difusificador} es una función $F:\mathbb{R} \rightarrow FS(U)$ que toma un valor escalar real $x^{*}$ en el universo $U$, $x^{*}\in U \subset \mathbb{R}$, y lo transforma en un conjunto difuso $A'$ sobre $U$.
\end{definition}

Para que el conjunto de salida represente de manera lo más fiel posible al valor de entrada, es necesario imponer algunas restricciones a la hora de construir el difusificador. La principal es que la función de pertenencia de $A'$ debe tener un valor alto en el punto $x^*$ (generalmente máximo, $\mu_{A'}(x^*) = \max(\mu_{A'}(\mu_{i})),\forall \mu_{i} \in U$). Además, si se considera que existe ruido o imprecisión en los valores entrada (por ejemplo imprecisiones provocadas por instrumentos de medida) se puede utilizar una función de pertenencia cuyo valor sea alto en los puntos próximos a $x^*$ y bajo (o incluso cero) en los más alejados.

Algunos de los difusificadores más utilizados son los siguientes \cite{wang1997}:

\begin{itemize}
\item\bfseries Difusificador singleton: \normalfont El \emph{difusificador singleton} (fig. \ref{fig:fuzzifier-singleton}) trasnforma un valor escalar real $x^* \in U$ en un conjunto difuso $A'$ en $U$, de forma que la función de pertenencia de $A'$ tiene valor 1 en el punto $x^*$ y 0 en el resto de puntos de $U$:
\begin{equation}
\mu_{A'}(x) = \begin{cases} 1 & \mbox{si } \mbox{x}=x^*, \\ 0 & \mbox{en cualquier otro caso} \end{cases}
\end{equation}
Este tipo de difusificador tiene la ventaja de ser simple y facilitar los cálculos realizados en el motor de inferencia. Sin embargo, tiene la desventaja de que no puede lidiar con ruido o imprecisiones en los valores de entrada. 
\item\bfseries Difusificador gaussiano: \normalfont El \emph{difusificador gaussiano} (fig. \ref{fig:fuzzifier-gaussian}) trasnforma un valor escalar real $x^* \in U$ en un conjunto difuso $A'$ en $U$, utilizando una función de pertenencia Gaussiana:
\begin{equation}
\mu_{A'}(x) = e^{-(\frac{x_1 - x_1^*}{a_1})^2}\star\ldots\star e^{-(\frac{x_n - x_n^*}{a_n})^2}
\end{equation}
donde $a_i$ son parámetros positivos y $\star$ es una t-norma, generalmente el producto algebraico o el mínimo. Este tipo de difusificador es adecuado cuando existe ruido o imprecisiones en los datos de entrada.
\item\bfseries Difusificador triangular: \normalfont El \emph{difusificador triangular} (fig. \ref{fig:fuzzifier-triangular}) trasnforma un valor escalar real $x^* \in U$ en un conjunto difuso $A'$ en $U$, utilizando una función de pertenencia triangular:
\begin{equation}
\mu_{A'}(x) = \begin{cases} (1 - \frac{|x_1 - x_1^*|}{b_1})\star\ldots\star  (1 - \frac{|x_n - x_n^*|}{b_n}) & \mbox{si } |x_i - x_i^*| \leq b_i, i = 1,2,\ldots,n, \\ 0 & \mbox{en cualquier otro caso} \end{cases}
\end{equation}
donde $b_i$ son parámetros positivos y $\star$ es una t-norma, generalmente el producto algebraico o el mínimo. Al igual que el difusificador gaussiano este tipo de difusificador es adecuado cuando existe ruido o imprecisiones en los datos de entrada.
\end{itemize}

\begin{figure}[H]
	\centering
	\begin{subfigure}[t]{\textwidth}
		\setlength\figureheight{4cm}
		\setlength\figurewidth{12cm}
		\input{figures/fuzzifiers/fuzzifier_singleton.tikz}
		\caption{Difusificador singleton.}
		\label{fig:fuzzifier-singleton}
	\end{subfigure}
	
	\vspace{1 cm}
	\begin{subfigure}[t]{\textwidth}
		\setlength\figureheight{4cm}
		\setlength\figurewidth{12cm}
		\input{figures/fuzzifiers/fuzzifier_gaussian.tikz}
		\caption{Difusificador gaussiano.}
		\label{fig:fuzzifier-gaussian}
	\end{subfigure}
	
	\vspace{1 cm}
	\begin{subfigure}[t]{\textwidth}
		\setlength\figureheight{4cm}
		\setlength\figurewidth{12cm}
		\input{figures/fuzzifiers/fuzzifier_triangular.tikz}
		\caption{Difusificador triangular.}
		\label{fig:fuzzifier-triangular}
	\end{subfigure}
		\caption{Representación de las funciones de pertenencia obtenidas con los difusificadores \emph{singleton} (\ref{fig:fuzzifier-singleton}), \emph{gaussiano} (\ref{fig:fuzzifier-gaussian}) y \emph{triangular} (\ref{fig:fuzzifier-triangular}).}
		\label{fig:fuzzifiers}
\end{figure}

\section{El controlador de Mamdani}
El método de inferencia difusa más utilizado es el llamado \emph{controlador de Mamdani} \cite{Mamdani1975}, propuesto por Mamdani y Assilian en 1975 para realizar el control de un motor de vapor a partir de un conjunto de reglas obtenidas de operadores humanos experimentados.
\section{Método de interpolación basado en índices de solapamiento}
En esta sección se introduce un nuevo método para resolver sistemas basados en reglas que generaliza el método clásico de interpolación , utilizando para ello índices de solapamiento \cite{bustince2013overlap}.\\
\\
Históricamente el método más utilizado para resolver sistemas basados en reglas, es decir, para calcular el consecuente \emph{B'}, era el método de interpolación \cite{klir1987}. En este método se utiliza la consistencia de Zadeh \emph{$O_{Z}$} \cite{zadeh1978}, dada en la ecuación \ref{eq:zadeh-consistency}. Los pasos a seguir son:

\begin{algorithm}
\DontPrintSemicolon
\KwIn{Un conjunto de reglas $R_{j}$, con $j \in \{1,\ldots,n\}$, un hecho \emph{A'} y el índice de consistencia $O_{Z}$ (ec. \ref{eq:zadeh-consistency}).}
\KwOut{\emph{B'}.}
\vspace{0.4 cm}
\For{$j \in \{1,\ldots,n\}$} {
Calcular $O_{Z}(A',A_{j}) = \max\limits_{x \in X}(\min(A'(x),A_{j}(x))) $
}
Construir $B' = \{(y, B'(y))|y \in Y\}$ dado por: \\
\centering
\nonl $B'(y) = \max\limits_{j=1}^{n}(\min(B_{j}(y),O_{Z}(A', A_{j})))$.\\
\Return{$B'$}\;
\caption{Método de interpolación}
\label{algo:interpolation-method}
\end{algorithm}
Dado que el índice de consistencia $O_{Z}$ es un índice de solapamiento que cumple la definición \ref{def:dubois-overlap-index}, el algoritmo \ref{algo:interpolation-method} se puede generalizar para utilizar cualquier índice de solapamiento:

\begin{algorithm}
\DontPrintSemicolon
\KwIn{Un conjunto de reglas $R_{j}$, con $j \in \{1,\ldots,n\}$ y un hecho \emph{A'}.}
\KwOut{\emph{B'}.}
\vspace{0.4 cm}
Seleccionar un operador de agregación $M_{1}$, una función de solapamiento $G_{O}$ y un índice de solapamiento O.\\
\For{$j \in \{1,\ldots,n\}$} {
Calcular $O(A', A_{j})$
}
Construir $B' = \{(y, B'(y))|y \in Y\}$ dado por: \\
\centering
\nonl $B'(y) = \overset{n}{\underset{j=1}{M_{1}}}(G_{O}(B_{j}(y),O(A', A_{j})))$.\\
\Return{$B'$}\;
\caption{Método de interpolación generalizado}
\label{algo:overlap-interpolation-method}
\end{algorithm}

Si en el algoritmo \ref{algo:overlap-interpolation-method} utilizamos $M_{1} = \max$, $G_{O} = \min$ y $O = O_{Z}$ entonces se recupera el algoritmo \ref{algo:interpolation-method}.

En el caso de que cada regla tenga varios antecedentes, se puede generalizar el algoritmo \ref{algo:overlap-interpolation-method} de la siguiente manera:

\begin{algorithm}
\DontPrintSemicolon
\KwIn{Un conjunto de reglas $R_{j}$ con varios antecedentes, con $j \in \{1,\ldots,n\}$ y un hecho \emph{A'}.}
\KwOut{\emph{B'}.}
\vspace{0.4 cm}
Seleccionar un operador de agregación $M$, una t-norma \emph{T} y un índice de solapamiento \emph{O}.\\
\For{$i =1 \to n$} {
Calcular $O(A'_{i}, A_{i1}),\ldots,O(A'_{m}, A_{im})$\\
Calcular $k_{i} = T(O(A'_{i}, A_{i1}),\ldots,O(A'_{m}, A_{im}))$\\
Construir sobre el universo de referencia \emph{Y} el conjunto $K_{i} = \{(y,k_{i})|y \in Y\}$
}
Construir $B' = \{(y, B'(y))|y \in Y\}$ dado por: \\
\centering
\nonl $B'(y) = \overset{n}{\underset{i=1}{M}}(\min(K_{i},B_{i}))$.\\
\Return{$B'$}\;
\caption{Método de interpolación generalizado para reglas con varios antecedentes}
\label{algo:multi-overlap-interpolation-method}
\end{algorithm}

